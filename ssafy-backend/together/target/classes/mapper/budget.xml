<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.budget">

	<!-- budget_num, user_email,budget_title,personnel, budget, fitness, date, 
		pro_id, pro_name,quantity, price, like_count -->

	<!-- 내 전체 예산안 보기 -->
	<select id="getMyBudgetList" parameterType="java.lang.String"
		resultType="com.ssafy.edu.model.BudgetInfo">
		SELECT BUDGET_NUM, USER_EMAIL, BUDGET_TITLE, PERSONNEL,
		BUDGET, SUITABILITY, BUDGET_DATE
		FROM BUDGET_INFO
		WHERE
		USER_EMAIL=(SELECT EMAIL FROM USER WHERE EMAIL=#{user_email})
	</select>

	<!-- 내 예산안 상세 보기 -->
	<select id="getOneBudgetInfo"
		parameterType="com.ssafy.edu.model.BudgetInfo"
		resultType="com.ssafy.edu.model.BudgetInfo">
		SELECT BUDGET_NUM, USER_EMAIL, BUDGET_TITLE, PERSONNEL,
		BUDGET, SUITABILITY, BUDGET_DATE
		FROM BUDGET_INFO
		WHERE
		BUDGET_NUM=#{budget_num}
	</select>

	<!-- 내 예산안 상세보기 품목리스트 -->
	<select id="getOneBudgetList"
		parameterType="com.ssafy.edu.model.Budget"
		resultType="com.ssafy.edu.model.BudgetListResult">
		SELECT PRO_ID,PRO_NAME, QUANTITY, PRICE FROM BUDGET_LIST
		WHERE BUDGET_NUM=#{budget_num};
	</select>

	<!-- 예산안 저장하기 -->
	<insert id="insertBudgetInfo"
		parameterType="com.ssafy.edu.model.BudgetInfo">
		INSERT INTO BUDGET_INFO(USER_EMAIL, BUDGET_TITLE,
		PERSONNEL, BUDGET, SUITABILITY, BUDGET_DATE)
		VALUES(#{user_email},#{budget_title},#{personnel},#{budget},#{suitability},date(now()));
	</insert>

	<select id="getLastInsertBudgetNum"
		parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT BUDGET_NUM FROM BUDGET_INFO 
		WHERE USER_EMAIL=#{user_email} ORDER BY BUDGET_NUM DESC LIMIT 1;
	</select>

	<insert id="insertBudgetList"
		parameterType="com.ssafy.edu.model.BudgetList">
		INSERT INTO BUDGET_LIST(BUDGET_NUM,PRO_ID,PRO_NAME,	QUANTITY, PRICE)
		VALUES(#{budget_num},#{pro_id},#{pro_name},#{quantity},#{price});
	</insert>

	<!--DELETE FROM 테이블명 WHERE = 조건 -->
	<delete id="deleteBudgetInfo" parameterType="java.lang.Integer">
		DELETE FROM
		BUDGET_INFO WHERE BUDGET_NUM=#{budget_num};
	</delete>

	<!-- <delete id="deleteBudgetList" -->
	<!-- parameterType="java.lang.Integer"> -->
	<!-- DELETE FROM BUDGET_LIST WHERE BUDGET_NUM=#{budget_num}; -->
	<!-- </delete> -->

	<!-- 적합/부적합 -->
	<update id="updateBudget" parameterType="com.ssafy.edu.model.BudgetInfo">
		UPDATE BUDGET_INFO SET SUITABILITY=#{suitability} WHERE
		BUDGET_NUM=#{budget_num}
	</update>

</mapper>

