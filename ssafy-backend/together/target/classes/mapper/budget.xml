<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.budget">

	<!-- budget_num, user_email,budget_title,personnel, budget, fitness, date, 
		pro_id, pro_name,quantity, price, like_count -->

	<!-- 내 전체 예산안 보기 -->
	<select id="getBudgetList" parameterType="java.lang.String"
		resultType="com.ssafy.edu.model.BudgetInfo">
		SELECT BUDGET_TITLE, PERSONNEL,BUDGET,FITNESS,
		DATE,LIKE_COUNT
		FROM BUDGET_INFO
		WHERE USER_EMAIL=#{user_email}
	</select>

	<!-- 내 예산안 상세 보기 -->
	<select id="getOneBudget"
		parameterType="com.ssafy.edu.model.BudgetInfo"
		resultType="com.ssafy.edu.model.BudgetInfo">
		SELECT BUDGET_TITLE, PERSONNEL,BUDGET,FITNESS,
		DATE,LIKE_COUNT
		FROM BUDGET_INFO
		WHERE USER_EMAIL=#{user_email} AND
		BUDGET_TITLE=#{budget_title};
	</select>
	
	<!-- 내 예산안 상세보기 품목리스트 -->
	<select id="getOneBudgetProductList"
		parameterType="com.ssafy.edu.model.Budget"
		resultType="com.ssafy.edu.model.BudgetListResult">
		SELECT PRO_ID,PRO_NAME, QUANTITY, PRICE FROM BUDGET_LIST WHERE USER_EMAIL=#{user_email} AND BUDGET_TITLE=#{budget_title};
	</select>
	
	<insert id="insertBudgetInfo"
		parameterType="com.ssafy.edu.model.BudgetInfo">
		INSERT INTO BUDGET_INFO(USER_EMAIL,
		BUDGET_TITLE,PERSONNEL,
		BUDGET, FITNESS,DATE,LIKE_COUNT)
		VALUES(#{user_email},#{budget_title},#{personnel},#{budget},#{fitness},date(now()),#{like_count});
	</insert>

	<insert id="insertBudgetList"
		parameterType="com.ssafy.edu.model.BudgetList">
		INSERT INTO BUDGET_LIST(USER_EMAIL,BUDGET_TITLE,
		PRO_ID,PRO_NAME, QUANTITY, PRICE)
		VALUES(#{user_email},#{budget_title},#{pro_id},#{pro_name},#{quantity},#{price});
	</insert>

	<!--DELETE FROM 테이블명 WHERE = 조건 -->
	<delete id="deleteBudgetInfo"
		parameterType="com.ssafy.edu.model.Budget">
		DELETE FROM BUDGET_INFO WHERE USER_EMAIL=#{user_email} AND
		BUDGET_TITLE=#{budget_title};
	</delete>

	<delete id="deleteBudgetList"
		parameterType="com.ssafy.edu.model.Budget">
		DELETE FROM BUDGET_LIST WHERE USER_EMAIL=#{user_email}
		and
		BUDGET_TITLE=#{budget_title} and PRO_ID=#{pro_id};
	</delete>
	
	<update id="updateBudgetFitness" parameterType="com.ssafy.edu.model.BudgetInfo">
	UPDATE BUDGET_INFO SET FITNESS=#{fitness} WHERE USER_EMAIL=#{user_email} AND BUDGET_TITLE=#{budget_title}
	</update>

</mapper>

